<!doctype html>
<html>
<head>
	<link href="lib/battleships/themes/wireframe/style.css" rel="stylesheet">
</head>
<body>
	<h1>Battleships</h1>

	<script src="http://localhost:8080/socket.io/socket.io.js"></script>
	<script src="lib/battleships/Battleships.js"></script>
	<script>
		const gameId = window.location.hash.split( '#' )[ 1 ];

		function createGame() {
			Battleships.create( 5, { 1: 1 } )
				.then( game => game.renderGameToElement( document.body ) )
				.then( game => game.start() )
				.catch( ( error ) => showGameOverScreen( error ) );
		}

		function showGameOverScreen( error ) {
			document.body.innerHTML = 'This game is not available because: ' + error;

			const button = document.createElement( 'button' );

			button.textContent = 'New game';
			button.addEventListener( 'click', () => {
				history.pushState( '', document.title, window.location.pathname + window.location.search );
				document.body.innerHTML = '';
				createGame();
			} );

			document.body.appendChild( button );
		}

		if ( !gameId ) {
			createGame();
		} else {
			Battleships.join( gameId )
				.then( game => game.renderGameToElement( document.body ) )
				.then( game => game.start() )
				.catch( error => showGameOverScreen( error ) );
		}
	</script>
</body>
</html>
